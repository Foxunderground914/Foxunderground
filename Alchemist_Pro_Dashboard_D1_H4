//@version=5
indicator("Alchemist Pro - D1, H4 Dashboard", overlay=true)

// Ez a script a "Dual LR" (Last Resistance/Support) logika alapj√°n sz√°m√≠tja ki a trendet
// t√∂bb el≈ëre defini√°lt szimb√≥lumra a Daily (D1) √©s 4 √≥r√°s (H4) id≈ëkereteken.
// Az eredm√©nyeket egy √°ttekint≈ë t√°bl√°zatban jelen√≠ti meg a charton.

// === Trend logika (Dual LR) ===
// Ez a f√ºggv√©ny az "A-alak√∫" (medve) √©s "V-alak√∫" (bika) gyertyaalakzatokat keresi,
// amelyek a kor√°bbi gyertya z√°r√≥√°r√°hoz k√©pest a jelenlegi gyertya mozg√°s√°t vizsg√°lj√°k.
// Ha a jelenlegi √°r √°tt√∂ri a kor√°bbi gyertya z√°r√≥√°r√°t (ami ellen√°ll√°s/t√°masz szintk√©nt funkcion√°l),
// akkor meger≈ës√≠ti a trend ir√°ny√°t.
f_getTrend() =>
    // Ellen≈ërzi, hogy az el≈ëz≈ë gyertya bullish volt-e (z√°r√≥ > nyit√≥)
    prevBullish = close[1] > open[1]
    // Ellen≈ërzi, hogy az el≈ëz≈ë gyertya bearish volt-e (z√°r√≥ < nyit√≥)
    prevBearish = close[1] < open[1]

    // "A-alak√∫" minta: El≈ëz≈ë bullish gyertya ut√°n a jelenlegi gyertya bearish (z√°r√≥ < nyit√≥)
    aShape = prevBullish and close < open
    // "V-alak√∫" minta: El≈ëz≈ë bearish gyertya ut√°n a jelenlegi gyertya bullish (z√°r√≥ > nyit√≥)
    vShape = prevBearish and close > open

    // Szintek t√°rol√°s√°ra szolg√°l√≥ v√°ltoz√≥k (Last Resistance / Last Support)
    var float aLevel = na // Az "A-alak√∫" szintje (el≈ëz≈ë gyertya z√°r√≥√°ra)
    var float vLevel = na // A "V-alak√∫" szintje (el≈ëz≈ë gyertya z√°r√≥√°ra)

    // Trend ir√°ny√°t jelz≈ë logikai v√°ltoz√≥k
    var bool bullTrend = false // Igaz, ha bullish trend van
    var bool bearTrend = false // Igaz, ha bearish trend van

    // Ha "A-alak√∫" minta alakul ki, r√∂gz√≠ti az aLevel-t
    if aShape
        aLevel := close[1]
    // Ha "V-alak√∫" minta alakul ki, r√∂gz√≠ti az vLevel-t
    if vShape
        vLevel := close[1]

    // Ha van aLevel √©s a jelenlegi z√°r√≥√°r felette van, akkor bullish trend
    if not na(aLevel) and close > aLevel
        bullTrend := true
        bearTrend := false // Biztos√≠tja, hogy ne legyen egyszerre bullish √©s bearish
    // Ha van vLevel √©s a jelenlegi z√°r√≥√°r alatta van, akkor bearish trend
    if not na(vLevel) and close < vLevel
        bullTrend := false // Biztos√≠tja, hogy ne legyen egyszerre bullish √©s bearish
        bearTrend := true

    // Visszat√©r a bullish √©s bearish trend √°llapot√°val
    [bullTrend, bearTrend]

// === Trend lek√©r√©se adott szimb√≥lumra √©s id≈ëkeretre ===
// Ez a f√ºggv√©ny a f_getTrend() logik√°j√°t alkalmazza egy megadott szimb√≥lumra
// a 4 √≥r√°s (240 perc) √©s Daily (D) id≈ëkereteken.
// Az eredm√©nyt ikonokk√° (üìà, üìâ, ‚ûñ) alak√≠tja a k√∂nnyebb vizu√°lis megjelen√≠t√©s √©rdek√©ben.
getTrend(sym) =>
    // Lek√©ri a bullish √©s bearish trend √°llapot√°t a 4 √≥r√°s id≈ëkereten
    [bull4h, bear4h] = request.security(sym, "240", f_getTrend(), lookahead=barmerge.lookahead_off)
    // Lek√©ri a bullish √©s bearish trend √°llapot√°t a Daily id≈ëkereten
    [bull1d, bear1d] = request.security(sym, "D", f_getTrend(), lookahead=barmerge.lookahead_off)

    // Ikonokk√° alak√≠tja a 4 √≥r√°s trendet
    t4h = bull4h ? "üìà" : bear4h ? "üìâ" : "‚ûñ"
    // Ikonokk√° alak√≠tja a Daily trendet
    t1d = bull1d ? "üìà" : bear1d ? "üìâ" : "‚ûñ"

    // Visszat√©r a 4 √≥r√°s √©s Daily trend ikonokkal
    [t4h, t1d]

// === T√°bl√°zatsor kit√∂lt≈ë f√ºggv√©ny ===
// Ez a f√ºggv√©ny egy t√°bl√°zat sor√°t t√∂lti ki a megadott szimb√≥lummal √©s trend ikonokkal.
// Kiemeli az aktu√°lisan megnyitott chart szimb√≥lum√°t.
fillRow(sym, row, t1d, t4h, currentSymbol, t) =>
    // Elt√°vol√≠tja a br√≥ker prefixeket (pl. FOREXCOM:, SAXO:) a szimb√≥lum nev√©b≈ël
    displaySym = str.replace(str.replace(sym, "FOREXCOM:", ""), "SAXO:", "")
    // Hozz√°ad egy kiemel≈ë ikont (üî∏) az aktu√°lis chart szimb√≥lum√°hoz
    label = currentSymbol == sym ? "üî∏ " + displaySym : displaySym

    // Kit√∂lti a t√°bl√°zat cell√°it
    table.cell(t, 0, row, label) // Szimb√≥lum neve
    table.cell(t, 1, row, t1d, text_color=t1d=="üìà"?color.green:t1d=="üìâ"?color.red:color.gray) // D1 trend √©s sz√≠n
    table.cell(t, 2, row, t4h, text_color=t4h=="üìà"?color.green:t4h=="üìâ"?color.red:color.gray) // H4 trend √©s sz√≠n
    // Az oszlop 3 (H1) √©s 4 (M15) √ºresen hagyva ebben a verzi√≥ban, de a t√°bl√°zat szerkezete k√©szen √°ll r√°juk.

// === Trendlek√©rdez√©s 17 el≈ëre defini√°lt szimb√≥lumra ===
// Ezek a v√°ltoz√≥k t√°rolj√°k a 17 szimb√≥lum Daily √©s 4 √≥r√°s trendjeit.
[tr4h1, tr1d1] = getTrend("FOREXCOM:AUDUSD")
[tr4h2, tr1d2] = getTrend("FOREXCOM:USDCAD")
[tr4h3, tr1d3] = getTrend("FOREXCOM:EURCAD")
[tr4h4, tr1d4] = getTrend("FOREXCOM:GBPCAD")
[tr4h5, tr1d5] = getTrend("FOREXCOM:AUDCAD")
[tr4h6, tr1d6] = getTrend("FOREXCOM:USDJPY")
[tr4h7, tr1d7] = getTrend("FOREXCOM:USDCHF")
[tr4h8, tr1d8] = getTrend("FOREXCOM:NZDUSD")
[tr4h9, tr1d9] = getTrend("FOREXCOM:GBPJPY")
[tr4h10, tr1d10] = getTrend("FOREXCOM:AUDJPY")
[tr4h11, tr1d11] = getTrend("FOREXCOM:GBPUSD")
[tr4h12, tr1d12] = getTrend("FOREXCOM:EURUSD")
[tr4h13, tr1d13] = getTrend("SAXO:XAUUSD") // Arany
[tr4h14, tr1d14] = getTrend("FOREXCOM:NAS100") // Nasdaq 100 index
[tr4h15, tr1d15] = getTrend("FOREXCOM:GBPCHF")
[tr4h16, tr1d16] = getTrend("FOREXCOM:AUDCHF")
[tr4h17, tr1d17] = getTrend("FOREXCOM:SPX500") // S&P 500 index

// === T√°bla l√©trehoz√°s √©s kit√∂lt√©s ===
// A t√°bl√°zat csak a legutols√≥ gyerty√°n friss√ºl a teljes√≠tm√©ny optimaliz√°l√°sa √©rdek√©ben.
if barstate.islast
    // L√©trehozza a t√°bl√°zatot a jobb fels≈ë sarokban, 5 oszloppal √©s 18 sorral (fejl√©c + 17 szimb√≥lum)
    var table t = table.new(position.top_right, 5, 18, border_width=1)

    // Fejl√©c (0. sor)
    table.cell(t, 0, 0, "Symbol", bgcolor=color.new(color.gray, 0), text_color=color.white)
    table.cell(t, 1, 0, "D1", bgcolor=color.new(color.gray, 0), text_color=color.white)
    table.cell(t, 2, 0, "H4", bgcolor=color.new(color.gray, 0), text_color=color.white)
    table.cell(t, 3, 0, "H1", bgcolor=color.new(color.gray, 90), text_color=color.white) // √úresen hagyva
    table.cell(t, 4, 0, "M15", bgcolor=color.new(color.gray, 90), text_color=color.white) // √úresen hagyva

    // Az aktu√°lisan megnyitott chart szimb√≥lum√°nak lek√©r√©se
    currentSymbol = syminfo.tickerid

    // Sorok kit√∂lt√©se (Szimb√≥lum, D1 trend, H4 trend)
    // Az oszlop 3 √©s 4 (H1, M15) √ºresen marad, de a t√°bl√°zat szerkezete k√©szen √°ll r√°juk.
    fillRow("FOREXCOM:AUDUSD", 1, tr1d1, tr4h1, currentSymbol, t)
    fillRow("FOREXCOM:USDCAD", 2, tr1d2, tr4h2, currentSymbol, t)
    fillRow("FOREXCOM:EURCAD", 3, tr1d3, tr4h3, currentSymbol, t)
    fillRow("FOREXCOM:GBPCAD", 4, tr1d4, tr4h4, currentSymbol, t)
    fillRow("FOREXCOM:AUDCAD", 5, tr1d5, tr4h5, currentSymbol, t)
    fillRow("FOREXCOM:USDJPY", 6, tr1d6, tr4h6, currentSymbol, t)
    fillRow("FOREXCOM:USDCHF", 7, tr1d7, tr4h7, currentSymbol, t)
    fillRow("FOREXCOM:NZDUSD", 8, tr1d8, tr4h8, currentSymbol, t)
    fillRow("FOREXCOM:GBPJPY", 9, tr1d9, tr4h9, currentSymbol, t)
    fillRow("FOREXCOM:AUDJPY", 10, tr1d10, tr4h10, currentSymbol, t)
    fillRow("FOREXCOM:GBPUSD", 11, tr1d11, tr4h11, currentSymbol, t)
    fillRow("FOREXCOM:EURUSD", 12, tr1d12, tr4h12, currentSymbol, t)
    fillRow("SAXO:XAUUSD", 13, tr1d13, tr4h13, currentSymbol, t)
    fillRow("FOREXCOM:NAS100", 14, tr1d14, tr4h14, currentSymbol, t)
    fillRow("FOREXCOM:GBPCHF", 15, tr1d15, tr4h15, currentSymbol, t)
    fillRow("FOREXCOM:AUDCHF", 16, tr1d16, tr4h16, currentSymbol, t)
    fillRow("FOREXCOM:SPX500", 17, tr1d17, tr4h17, currentSymbol, t)
